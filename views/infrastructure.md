# Инфраструктурное представление

Система работает на облачной инфраструктуре. Мы рассмотрим, как в ее рамках будут решаться вопросы сетевого взаимодействия, балансировки нагрузки и масштабирования.

## Сети

Сервисы и клиентское приложение взаимодействуют между собой в рамках сетей, внутренних (приватных) и внешних (публичных). Публичные сети используются для взаимодействия клиенского приложения с системой через Messaging Grid и API Gateway. Также в публичной сети происходит взаимодействие с внешними сервисами, на данный момент это социальные сети. Сами сервисы находятся внутри приватной сети, где происходит их взаимодействие между собой, с API Gateway и virtualized middleware.

![Сети](https://raw.githubusercontent.com/ariverrun/coursework/main/assets/network.png "Сети")

Общение всех вышеупомянутых компонентов происходит по HTTP-протоколу или черех шину сообщений (см. функциональное представление).

## Балансировка нагрузки

Балансировки нагрузки в системе делится на первичную и вторичную.

Первичная представляет собой GeoDNS роутинг и нагрузка балансируется между региональными узлами. Запросы пользователей не могут быть перенаправлены на узел другого региона просто потому что в их "родном" регионе нагрузка на узел резко повысилась.

Вторичная балансировка производится на уровне API Gateway и нагрузка здесь распределяется между сервисами в рамках одного Process Unit.

## Масштабирование

Аналогично с балансировкой, в системе можно выделить два типа масштабирования:

Первый тип представляет собой масштабирование Process Unit'ов и он не производится автоматически. Если пользователь работает с системой в регионе, где раньше не было пользователей, мы не поднимаем там автоматически всю инфраструктуру. Это процесс происходит в ручном режиме и выполняется после решения не-технических вопросов, таких как юридические и экономические. 

Второй тип - масшитабирование самих сервисов происходит автоматически, через контроллеры сервисов с использованием задержки создания сервиса, чтобы избежать избыточного развертывания. Ненужные сервисы также автоматически удаляются контроллерами (с дополнительной задержкой, значительно выше чем при создании нового инстанса).
