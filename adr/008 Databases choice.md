# Выбор СУБД

## Контекст:

У нас есть 6 сервисов, которые надлежит реализовать, каждый из них имеет свои доменные сущности, которые нужно как-то хранить. Характер работы с этими сущностями приемущественно представляет собой операции чтения и записи. Обновление происходит в ограниченном круге сценариев: редактирование пользователем своего профиля, редактирование описания сообщества, изменение плана тренировки.

Существует несколько возможных опций для выбора.

1. Реляционные СУБД:
    1. Требуют наличия четкой схемы данных.
    2. Поддерживают транзакционность.
    3. Масштабируются вертикально, горизонтальное масштабирование также возможно, но является относительно сложным.
    4. Скорость доступа к данным может уступать во многих случаях другим видам СУБД, но зато сам доступ может быть очень гибким и оптимизируемым за счет индексов и других средств.
2. Нереляционные СУБД:
    1. Документоориентированные:
        1. Имеют гибкую схему данных.
        2. Хорошо масштабируются горизонтально и вертикально.
        3. Поддержка транзакций ограничена.
        4. Поддержка сложных запросов ограничена.
    2. Ключ-значение:
        1. Имеют высокую скорость доступа к данным по ключу.
        2. Хорошо масштабируются горизонтально и вертикально.
        3. Не поддерживают сложные запросы, доступ только по ключу.
    3. Столбцовые:
        1. Позволяют эффективно сжимать данные.
        2. Оптимизированы для чтения, хорошо подходят для OLAP сценариев.
        3. Хорошо масштабируются горизонтально и вертикально.
        4. Ограниченная поддержка транзакций.
    4. Семейства стобцов:
        1. Позволяют эффективно сжимать данные.
        2. Оптимизированы на запись, хорошо подходят для OLTP сценариев.
        3. Хорошо масштабируются горизонтально и вертикально.
        4. Ограниченная поддержка транзакций.
    4. Графовые:
        1. Хорошо подходят для работы с данными которые имеют очень много связей.
        2. Имеют гибкую структуру, можно легко создать новые типы взаимосвязей.
        3. Ограниченная поддержка транзакционности.
        4. Подходят для специфических сценариев связанных с обходом графов.

## Решение

Для хранения всех сущностей, кроме тех, что отдельно указаны ниже, будет использоваться реляционный подход. Для основной части сервисов и сущностей мы будем использовать PostreSQL, для сервиса тренировок MySQL, так как он будет чаще подвержен изменению сущностей, а PostreSQL хуже справляется с такими сценариями, хотя предпочтительнее в остальных.

Для хранения метрик показателей спортсменов будет использоваться база семейства столбцов, а именно Apache Cassandra, там как объем данных в этом сервисе будет очень большим, что потребует горизонтального масштабирования, а скорость записи требуется высокая.

Также для аналитических целей стоит добавить репликцию данных в столцовую СУБД для эффективной работы с OLAP сценариями.

Для быстрого полнотекстового поиска сообществ и поиска по истории сообщений, будет применяться Elastic.

В качестве хранилища кэша в Process Unit будет использоваться Redis из-за его высокой скорости работы.

## Статус:

принято

## Последствия:

1. Каждая сущность будет храниться в том виде, который наиболее оптимально подходит к сценариям работы с ней.
2. Те данные, объем которых наиболее велик будут храниться так, чтобы иметь возможность легкого масштабирования.
3. Наличие различных баз данных потребует наличия специалистов для каждой из применяемых технологий.

